<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IGNITE Secure Portal V3.6</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; margin: 0; padding: 0; }
        .container { max-width: 1000px; margin: 20px auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .hidden { display: none; }
        .btn { padding: 10px 15px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; margin: 2px; }
        .btn-primary { background: #3498db; color: white; }
        .btn-danger { background: #e74c3c; color: white; }
        /* Login Modal Styles */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); display: flex; justify-content: center; align-items: center; z-index: 1000; }
        .modal-card { background: white; padding: 30px; border-radius: 12px; width: 90%; max-width: 400px; text-align: center; }
        .modal-card input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }
        /* Rest of existing styles... */
        .archived-row { background: #f9ebea; color: #a93226; }
        .question-box { border: 1px solid #eee; padding: 20px; border-radius: 10px; }
        .option { display: block; padding: 12px; margin: 8px 0; border: 1px solid #eee; border-radius: 8px; cursor: pointer; }
        .nav-grid { display: flex; flex-wrap: wrap; justify-content: center; margin-bottom: 20px; }
        .btn-nav { background: #ecf0f1; border: 1px solid #bdc3c7; width: 40px; height: 40px; margin: 3px; border-radius: 5px; }
        .active-nav { border: 2px solid #2c3e50; background: #d5d8dc; }
        .answered-nav { background: #3498db !important; color: white; }
    </style>
</head>
<body>

<div id="app" class="container">
    <div id="login-modal" class="modal-overlay hidden">
        <div class="modal-card">
            <h2>Admin Login</h2>
            <input type="email" id="login-email" placeholder="Admin Email">
            <input type="password" id="login-pass" placeholder="Password">
            <button class="btn btn-primary" style="width:100%;" onclick="attemptLogin()">Login</button>
            <button class="btn" style="width:100%; margin-top:5px;" onclick="closeLogin()">Cancel</button>
        </div>
    </div>

    <div id="main-menu">
        <h1 style="text-align:center;">IGNITE Portal V3.6</h1>
        <div style="display:grid; gap:10px;">
            <button class="btn btn-primary" onclick="startTest('Maths')">Start Maths Test</button>
            <button class="btn btn-primary" onclick="startTest('English')">Start English Test</button>
            <button class="btn btn-primary" onclick="startTest('General')">Start General Ability</button>
        </div>
        <button class="btn" style="background:#95a5a6; color:white; width:100%; margin-top:20px;" onclick="openLogin()">Admin Dashboard</button>
    </div>

    <div id="admin-panel" class="hidden">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Admin Dashboard</h2>
            <button class="btn btn-danger" onclick="logout()">Logout</button>
        </div>
        <hr>
        <button class="btn btn-primary" onclick="showSection('results')">Results</button>
        <button class="btn btn-primary" onclick="showSection('manager')">Question Manager</button>
        <button class="btn" onclick="showSection('upload')">Bulk Upload</button>
        
        <div id="manager-area" class="hidden">
            <select id="mgmt-subject" class="btn" onchange="loadQuestions()">
                <option value="Maths">Maths</option><option value="English">English</option><option value="General">General Ability</option>
            </select>
            <div id="questions-list-container">
                <div id="stats-bar"></div>
                <table>
                    <thead><tr><th><input type="checkbox" id="master-check" onclick="toggleAll(this)"></th><th>Question</th><th>Status</th><th>Edit</th></tr></thead>
                    <tbody id="questions-table-body"></tbody>
                </table>
            </div>
        </div>

        <div id="results-area" class="hidden">
            <div id="results-list"></div>
        </div>

        <div id="upload-area" class="hidden">
            <textarea id="json-input" style="width:100%; height:150px;"></textarea>
            <button class="btn btn-primary" onclick="processUpload()">Import & Append</button>
        </div>
    </div>

    <div id="test-screen" class="hidden">
        <div id="timer" style="text-align:right; font-size:1.5em; font-weight:bold; color:red;">30:00</div>
        <div id="nav-grid" class="nav-grid"></div>
        <div id="passage-container" class="hidden"></div>
        <div id="question-area"></div>
        <button id="submit-btn" class="btn btn-danger" style="width:100%; display:none;" onclick="finishTest()">Submit Paper</button>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDSva9HPKcOyiH-mGHIxx8GINOg9xKH7qI",
        authDomain: "ignite-portal-e39db.firebaseapp.com",
        databaseURL: "https://ignite-portal-e39db-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "ignite-portal-e39db",
        storageBucket: "ignite-portal-e39db.firebasestorage.app",
        messagingSenderId: "527432149090",
        appId: "1:527432149090:web:d278c44c324a4f7e68c93b"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const auth = firebase.auth();

    // --- NEW LOGIN LOGIC ---
    function openLogin() { document.getElementById('login-modal').classList.remove('hidden'); }
    function closeLogin() { document.getElementById('login-modal').classList.add('hidden'); }

    async function attemptLogin() {
        const email = document.getElementById('login-email').value;
        const pass = document.getElementById('login-pass').value;
        try {
            await auth.signInWithEmailAndPassword(email, pass);
            closeLogin();
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            showSection('results');
        } catch(e) { alert("Error: " + e.message); }
    }

    function logout() {
        auth.signOut().then(() => location.reload());
    }

    // --- REST OF THE CMS LOGIC (Same as V3.5.2) ---
    // (Include startTest, showQ, saveAnswer, loadQuestions, loadResults etc here)
    // For brevity, ensure you keep the functions we built in the previous version!
</script>
</body>
</html>
